@page
@{
    ViewData["Title"] = "Увійти";
}

<div class="min-h-screen flex items-center justify-center bg-gray-100 px-4">
    <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Увійти в Badmik</h2>

        <form id="loginForm">
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700">Електронна пошта</label>
                <input type="email" id="email" name="email"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-xl" required />
            </div>

            <div class="mb-4">
                <label for="password" class="block text-sm font-medium text-gray-700">Пароль</label>
                <input type="password" id="password" name="password"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-xl" required />
            </div>

            <div class="flex items-center mb-6">
                <input id="rememberMe" type="checkbox"
                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                <label for="rememberMe" class="ml-2 text-sm text-gray-700">Запам’ятати мене</label>
            </div>

            <div id="errorMsg" class="text-red-600 text-sm mb-4 hidden"></div>

            <button type="submit" id="loginBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-2xl flex items-center justify-center">
                <span id="btnText">Увійти</span>
                <svg id="spinner" class="ml-2 h-5 w-5 text-white animate-spin hidden"
                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
            </button>

            <div class="mt-4 text-center text-sm text-gray-500">
                Не маєте акаунту? <a href="/register" class="text-blue-600 hover:underline">Зареєструватися</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $("#loginForm").on("submit", function (e) {
            e.preventDefault();

            const email = $("#email").val().trim();
            const password = $("#password").val();
            const rememberMe = $("#rememberMe").is(":checked");

            $("#errorMsg").hide().text("");
            $("#loginBtn").prop("disabled", true);
            $("#spinner").removeClass("hidden");
            $("#btnText").text("Зачекайте...");

            $.ajax({
                url: "/api/auth/login",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ email, password, rememberMe }),
                success: function (result) {
                    localStorage.setItem("token", result.token);
                    window.location.href = "/dashboard";
                },
                error: function (xhr) {
                    const msg = xhr.responseJSON?.message || "Помилка входу";
                    $("#errorMsg").text(msg).removeClass("hidden");
                },
                complete: function () {
                    $("#loginBtn").prop("disabled", false);
                    $("#spinner").addClass("hidden");
                    $("#btnText").text("Увійти");
                }
            });
        });
    </script>
}